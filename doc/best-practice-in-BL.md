## 前言
作为一个创业公司，贝聊在使用这个版本系统替代walle已经接近一年了，从无到有，一路过来踩过很多坑，经过一年的实践和改进，我们在系统部署上
开始有了一个比较规范的机制，很多方面都有往规范化走。如果使用这个版本发布系统，哪些地方需要注意的，说下在贝聊的经历。  

## 版本控制
**SVN**  
svn我们强制svn的分支 tag目录名为 trunk、branches、tags，如果不是，在发布系统选择分支的时候，是读取不到svn的分支的，当然，你可以手动输入分支目录
但是我们不建议，在使用的过程中，经常有开发人员输入分支目录，不正确导致在编译阶段读取分支失败。  
所以，使用这个系统发布的，svn的目录建议采用trunk、branches、tags。  

**GIT**  
git不存在目录问题，唯一可以建议的是，要隔一段时间删除无用的分支和tags，否则在选择分支的时候，下拉的分支会比较多（如果你的版本迭代非常频繁的话）

## 项目权限
**运维拥有最高权限**  
版本发布是由运维来控制的，所以必须设置一个或者多个运维账号，拥有所有权限。一般来说，生产环境的系统发布是非常敏感的，运维对时间段、系统发布顺序都有严格的控制，所以生产环境的版本发布需要由运维来把关。  
**项目负责人**  
每个项目的负责人可以最多配置3个，建议最好配置2个或3个，项目负责人拥有对该项目上线的审核权限，为了避免紧急上线负责人联系不上的时候，配置多一个负责人作为预备方案是比较合理的。

## 强制编译
在创建上线单的时候，有一个选项 **强制编译** ，这个是说如果发布版本 + commmitId 一致的情况下，如果之前已经发布过，那么不需要选择强制编译，发布系统会去查找之前已经编译打包好的包进行解压发布。比如：  
  >Passport项目下有 passport-impl、passport-admin2个模块，如果同一个分支，发布passport-impl之后，passport-admin发布就不需要在编译了，直接用之前打包的版本可以加快速度，不需要经过编译，提高发布效率。

## 灰度发布
生产环境大部分系统都比较敏感，为了避免一个项目因各种原因导致发布失败，进而导致该服务全线挂掉这种极端情况，我们推荐在发布过程进行灰度发布，每次固定只能发该项目的一部分机器，待发完检测进程有启动之后，再发另外一部分机器。  
在贝聊，我们是通过发布系统做了限制，将一个项目的服务器分为2个服务器组，系统限制每次只能发一个组，进而从系统上控制和实现灰度发布。  
![](http://7xrmyq.com1.z0.glb.clouddn.com/d11.png)
